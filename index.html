<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Route 66: Health Disparities Along Boston's Bus Route</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
  <script src="https://unpkg.com/scrollama"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <!-- SortableJS for drag-and-drop reordering -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
</head>
<body>
  <div id="map"></div>
  <div id="story">
    <div id="intro">
      <h1>Health on the Line: 6 Miles and 23 Years Along the 66 Bus Route</h1>
      <p> </p>
      <p>Greater Boston's transit infrastructure is itself a reflection of the city's deep divides. All the major rail lines connect the city core to wealthy suburbs, mostly avoiding the poorer parts of the city â€” Roxbury, Dorchester, Mattapan, Chelsea, Everett, and Revere. This arterial rail layout leaves the 66 bus route the closest thing Greater Boston has to a ring route, connecting with all branches of the Green Line, the Red Line, and the Orange Line, running through drastically unequal areas in just six miles.</p>
      <p>Scroll down to explore the route through photos and data.</p>
    </div>
    <div id="scrolly">
      <div id="graphic"></div>
    </div>
    <div id="references">
      <h2>References</h2>
      <p>[1] XXX </p>
      <p>Include all sources, data, and image credits that were used in this project.</p>
      <p>These can be formatted as a bibliography list, citations, or any other appropriate format for your academic or professional needs.</p>
    </div>
  </div>

  <div id="control-panel">
    <button id="toggle-edit">Customize Order</button>
    <div id="order-editor" style="display: none;">
      <p>Drag items to reorder:</p>
      <div id="sortable-list"></div>
      <button id="save-order">Save Order</button>
      <button id="cancel-edit">Cancel</button>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Add code for the order customization interface
    document.getElementById('toggle-edit').addEventListener('click', function() {
      const orderEditor = document.getElementById('order-editor');
      if (orderEditor.style.display === 'none') {
        orderEditor.style.display = 'block';
        
        // Populate the sortable list with current item order
        const sortableList = document.getElementById('sortable-list');
        sortableList.innerHTML = '';
        
        customOrder.forEach((index, position) => {
          if (photoData[index]) {
            const item = document.createElement('div');
            item.className = 'sortable-item';
            item.setAttribute('data-index', index);
            
            // Determine if this is a text entry or image
            const isTextOnly = !photoData[index].filename || photoData[index].filename.trim() === '';
            
            if (isTextOnly) {
              item.innerHTML = `
                <div class="text-icon">Txt</div>
                <span>${photoData[index].title || 'Text Entry'}</span>
              `;
            } else {
              // Only show title if explicitly provided
              const displayTitle = photoData[index].title && photoData[index].title.trim() !== '' 
                ? photoData[index].title 
                : 'Item ' + (position + 1); // Just use a position number if no title
              
              item.innerHTML = `
                <img src="assets/img/${photoData[index].filename.trim()}" width="50" height="50" style="object-fit: cover; margin-right: 10px;">
                <span>${displayTitle}</span>
              `;
            }
            
            sortableList.appendChild(item);
          }
        });
        
        // Initialize sortable
        new Sortable(sortableList, {
          animation: 150,
          ghostClass: 'sortable-ghost'
        });
      } else {
        orderEditor.style.display = 'none';
      }
    });
    
    // Save the new order
    document.getElementById('save-order').addEventListener('click', function() {
      const items = document.querySelectorAll('.sortable-item');
      const newOrder = Array.from(items).map(item => parseInt(item.getAttribute('data-index')));
      
      reorderPhotos(newOrder);
      document.getElementById('order-editor').style.display = 'none';
    });
    
    // Cancel editing
    document.getElementById('cancel-edit').addEventListener('click', function() {
      document.getElementById('order-editor').style.display = 'none';
    });
  </script>
</body>
</html>
